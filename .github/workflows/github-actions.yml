# https://docs.github.com/ru/actions/writing-workflows/workflow-syntax-for-github-actions#jobsjob_idneeds
name: deploy su-blog.ru
run-name: Install SU-BLOG instance 

on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main

permissions: read-all

defaults:
  run:
    working-directory: ${{ vars.WORKING_FOLDER }}

jobs:
  ci:
    name: Continuous Integration
    runs-on: su-blog
    timeout-minutes: 60
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Run tests
      if: ${{ github.ref != 'refs/heads/main' }}
      run: |
        make test
  cd:
    name: Continuous Delivery
    runs-on: su-blog
    needs: ci
    timeout-minutes: 15
    steps:
    - name: Start service
      run: |
        make start
